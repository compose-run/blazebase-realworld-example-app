{"version":3,"sources":["services/compose.ts","services/user.ts","services/article.ts","types/location.ts","types/genericFormField.tsx","components/ContainerPage.tsx","components/FormGroup.tsx","components/Errors.tsx","components/GenericForm.tsx","components/ArticleEditor.tsx","components/Pages/EditArticle.tsx","components/Footer.tsx","components/Header.tsx","types/style.ts","components/ArticlePreview.tsx","components/Pagination.tsx","components/ArticlesViewer.tsx","components/Pages/Home.tsx","components/Pages/Login.tsx","components/Pages/NewArticle.tsx","components/Pages/Register.tsx","components/Pages/Settings.tsx","components/UserInfo.tsx","components/Pages/ProfilePage.tsx","components/Pages/ArticlePage.tsx","components/App.tsx","index.tsx"],"names":["app","initializeApp","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","db","initializeFirestore","ignoreUndefinedProperties","firebaseAuth","getAuth","useReducerSafe","reducer","initialState","useReducer","val","dispatch","mountedRef","useRef","useEffect","current","useCallback","s","isPromise","p","Object","prototype","toString","call","emit","type","name","value","ts","id","a","addDoc","collection","serverTimestamp","Error","message","composeResolvers","emitWithResponse","Math","random","promise","Promise","resolve","undefined","cacheBehaviorLocalStorage","localStorage","setItem","JSON","stringify","getRealtimeState","initialBehaviorFromCacheQuery","query","orderBy","limit","getDocs","docs","doc","metadata","hasPendingWrites","data","saveReducer","reducerCode","initial","setDoc","getResolver","eventId","resolver","realtimeReducer","initialValue","loadingValue","context","event","cacheOrLoadingValue","cache","getItem","parse","getCachedBehaviorLocalStorage","kind","currentValue","emitToSelf","pendingEvents","concat","then","newContext","reduce","toMillis","useRealtimeReducer","realtimeContext","emitEvent","getDoc","snapshot","exists","querySnapshot","newStreamEventsQuery","onSnapshot","usersVersion","useUsers","users","action","errors","returnValue","some","u","email","user","username","uid","keys","length","map","newUser","useProfiles","useUser","useFollowers","followers","following","userFollowers","follower","leader","unauthorized","firebaseUser","acc","curr","setFirebaseUser","onAuthStateChanged","useFirebaseUser","find","articlesVersion","useArticlesDB","articles","slug","title","article","description","body","createdAt","updatedAt","updateArticleTags","tagList","filter","useArticleTags","articleTagsOption","pt","includes","tag","payload","useArticleFavorites","favorite","useArticles","articlesDB","articleTags","articleFavorites","authors","articleDB","articleTag","Date","favorited","favoritesCount","values","author","useArticleCommentsDB","comments","commentId","comment","c","redirect","path","location","hash","buildGenericFormField","placeholder","fieldType","lg","ContainerPage","children","className","FormGroup","disabled","onChange","TextAreaFormGroup","rows","ListFormGroup","listValue","onEnter","onRemoveItem","onKeyDown","ev","key","preventDefault","onKeyUp","onListFieldKeyUp","index","onClick","Errors","entries","field","fieldError","GenericForm","fields","formObject","submitButtonText","onSubmit","onAddItemToList","onRemoveListItem","onUpdateField","listName","target","ArticleEditor","submitting","useState","currentArticle","setCurrentArticle","tagTextbox","setTagTextbox","_","i","EditArticle","useParams","emitArticlesAction","setSubmitting","setErrors","newArticle","now","Footer","to","href","Header","NavItem","text","UserLinks","GuestLinks","icon","exact","activeClassName","classObjectToClassName","obj","join","ArticlePreview","image","isSubmitting","emitFavoriteAction","src","format","TagList","Pagination","currentPage","count","itemsPerPage","onPageChange","ceil","range","ArticlesViewer","toggleClassName","tabs","selectedTab","onTabChange","setCurrentPage","favorites","feedArticles","sort","b","getTime","pageArticles","slice","articlesCount","ArticlesTabSet","ArticleList","tab","Tab","active","Home","setSelectedTab","buildTabsNames","HomeSidebar","Array","from","Set","tags","useTags","Login","loggingIn","setLoggingIn","setEmail","password","setPassword","signInWithEmailAndPassword","login","NewArticle","emitArticleAction","Register","signingUp","setSigningUp","setUser","emitUserAction","createUserWithEmailAndPassword","bio","register","Settings","oldUser","updating","setUpdating","signOut","UserInfo","onFollowToggle","onEditSettings","sessionUsername","EditProfileButton","ToggleFollowButton","ProfilePage","emitFollowAction","submittingFollow","setSubmittingFollow","useLocation","pathname","endsWith","profiles","profile","page","ArticlePage","ArticlePageBanner","ArticleMeta","CommentSection","props","ArticleAuthorInfo","OwnerArticleMetaActions","NonOwnerArticleMetaActions","submittingFavorite","setSubmittingFavorite","btn","deleting","setDeleting","fromEntries","useArticleComments","CommentForm","style","display","ArticleComment","setBody","submittingComment","emitCommentAction","e","App","userIsLogged","GuestOnlyRoute","UserOnlyRoute","rest","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.9b0d7e18.chunk.js","sourcesContent":["import { useReducer, useEffect, useCallback, useRef, Reducer, Dispatch, ReducerAction, ReducerState } from 'react';\nimport { initializeApp } from 'firebase/app';\nimport {\n  initializeFirestore,\n  collection,\n  addDoc,\n  serverTimestamp,\n  query,\n  onSnapshot,\n  orderBy,\n  limit,\n  doc,\n  getDoc,\n  getDocs,\n  setDoc,\n  Timestamp,\n} from 'firebase/firestore';\nimport { getAuth, onAuthStateChanged } from 'firebase/auth';\n\n/*\nBefore we release the sample app:\n\n- Debug all parts of the app\n- uniform handling of normalization/denormalization (relationships) & querying\n- Docs\n\nBefore we allow anyone to use the library themselves:\n\n- Make a proper open source repo for firebase wrapper with a proper name\n- prevent the uid field from being forged via security rules\n- prevent people from rewriting past histories or deleting each others events via security rules\n- ensure that we only pull one namespace globally so we don't double subscribe and proccess things (maybe via wrapping in memoize?)\n- disallow \"/\" in names or encode it for people\n- catch all firebase errors\n- garbage collect localstorage cache (and firebase cache)\n- minify reducer before caching to ignore comments and whitespace etc https://www.npmjs.com/package/uglify-js \n  - but also keep unminified version to give error message proper diff\n\n- Convert below todos to issues:\n\n- allow key-based lookup when not the whole object is needed\n- allow full range of firebase querying for reduced state (otherwise pulling everything in every sub component kills composability really)\n- need a better recovery for when you accidentally overwrite the state (and want to migrate back to a state that doesn't exist semantically)\n- disallow randomness (and other non-determinisim) or make it determantistic https://croquet.io/docs/croquet/tutorial-2_8_random.html\n- useOptimisticRealtimeReducer: optimistic updates (proccess stream events locally instead of server roundtrip; and then jumps to new server state if it's difference)\n\n*/\n\n// TODO - will need to find a way for users to supply their own firebase credentials\nconst firebaseConfig = {\n  apiKey: 'AIzaSyDZtMhc933h53_fbJFmyM76Mh6aRreHZE8',\n  authDomain: 'compose-run.firebaseapp.com',\n  projectId: 'compose-run',\n  storageBucket: 'compose-run.appspot.com',\n  messagingSenderId: '685832812042',\n  appId: '1:685832812042:web:9c1ff1eca82128832791f3',\n  measurementId: 'G-ZX4ZC2215P',\n};\n\n// Initialize Firebase\nconst app = initializeApp(firebaseConfig);\nconst db = initializeFirestore(app, {\n  ignoreUndefinedProperties: true,\n});\nexport const firebaseAuth = getAuth(app);\n\n// There are sometimes race conditions around cleaning up\n// a memory leak and when React detects and complains about it\n// This is a wrapper around useReducer that ensures React's\n// memory leak detector won't complain\nexport const useReducerSafe = <A, B, R extends Reducer<A, B>>(\n  reducer: R,\n  initialState: ReducerState<R>\n): [ReducerState<R>, Dispatch<ReducerAction<R>>] => {\n  const [val, dispatch] = useReducer(reducer, initialState);\n  const mountedRef = useRef<boolean>();\n  useEffect(() => {\n    mountedRef.current = true;\n    return () => {\n      mountedRef.current = false;\n    };\n  }, []);\n  const safeDispatch = useCallback(\n    (s) => {\n      if (mountedRef.current) {\n        dispatch(s);\n      }\n    },\n    [dispatch]\n  );\n  return [val, safeDispatch];\n};\n\nfunction isPromise<A>(p: Promise<A> | A): boolean {\n  return p && Object.prototype.toString.call(p) === '[object Promise]';\n}\n\n// This seems like a more React-safe way to access\n// the currently-logged-in Firebase user.\n// The other way `getAuth(app).currentUser` doesn't work with React all of the time\nexport const useFirebaseUser = () => {\n  const [firebaseUser, setFirebaseUser] = useReducerSafe((acc, curr) => curr, null);\n  useEffect(() => onAuthStateChanged(firebaseAuth, (user) => setFirebaseUser(user)), []);\n  return firebaseUser;\n};\n\n// This is a generic help to emit both stream events\n// as well as cached behavior values\nexport const emit = async <A>(\n  type: string,\n  name: string,\n  value: A,\n  ts?: Timestamp, // timestamp from an event if we have one\n  id?: number // how we tie together an emitted event and the reducer's response\n) => {\n  try {\n    await addDoc(collection(db, type, name, 'values'), {\n      value,\n      ts: ts || serverTimestamp(),\n      id,\n    });\n  } catch (e) {\n    throw new Error('Error emitting event: ' + e.message);\n  }\n};\n\n// This allows us to tie together an emitted event and the reducer's \"response\".\n// `composeResolvers` is a map from an eventId to that event's Promise's resovle function.\n// When the reducer resolver that event, it passes that resolve function as the last argument.\n// Calling `await resolve(errors)` for example,\n// allows the event emitter to `await` errors from the \"server\".\nconst composeResolvers = {};\nexport function emitWithResponse<B, C>(name: string, value: B): Promise<C> {\n  const id = Math.random();\n  const promise = new Promise<C>((resolve) => (composeResolvers[id] = resolve));\n  emit('streams', name, value, undefined, id);\n  return promise;\n}\n\n// cache all behaviors in localstorage for optimisic loading\nfunction cacheBehaviorLocalStorage<A>(name: string, value: A, ts: Timestamp) {\n  localStorage.setItem(\n    `compose-cache-${name}`,\n    JSON.stringify({\n      value,\n      ts,\n    })\n  );\n}\n\n// TODO - store the time retrieved from cached behavior so we can garbage collect\n// every X days or so? (make this a parameter?)\nfunction getCachedBehaviorLocalStorage(name: string) {\n  const cache = localStorage.getItem(`compose-cache-${name}`);\n  if (cache) {\n    return JSON.parse(cache).value; // maybe do something with ts eventually;\n  }\n}\n\nexport const getRealtimeState = async (name: string) => {\n  const initialBehaviorFromCacheQuery = query(\n    collection(db, 'behaviors', name, 'values'),\n    orderBy('ts', 'desc'),\n    limit(1)\n  );\n  const {\n    docs: [doc],\n  } = await getDocs(initialBehaviorFromCacheQuery);\n  if (doc && !doc.metadata.hasPendingWrites) {\n    return doc.data().value;\n  }\n};\n\n// save the reducer code to firebase so we can ensure all reducers\n// with the same name are identical\nfunction saveReducer<A>(name: string, reducerCode: string, initial: A) {\n  setDoc(doc(db, 'behaviors-reducers', name), {\n    reducerCode,\n    initial,\n  });\n}\n\ninterface RegisterEmitToSelf<a, b> {\n  emitToSelf: (event: RealtimeEvent<a, b>) => void;\n  kind: 'RegisterEmitToSelf';\n}\n\ninterface MismatchedReducerEvent {\n  kind: 'MismatchedReducerEvent';\n}\n\ninterface ReductionEvent<b> {\n  value: b;\n  ts: Timestamp;\n  kind: 'ReductionEvent';\n  id: number;\n}\n\ninterface CacheLoadedEvent<a> {\n  currentValue: a;\n  ts: Timestamp;\n  kind: 'CacheLoadedEvent';\n}\n\ninterface CacheEmptyEvent {\n  kind: 'CacheEmptyEvent';\n}\n\ninterface InitialValuePromiseLoadedEvent<a> {\n  currentValue: a;\n  kind: 'InitialValuePromiseLoadedEvent';\n}\n\ntype RealtimeEvent<a, b> =\n  | RegisterEmitToSelf<a, b>\n  | MismatchedReducerEvent\n  | CacheLoadedEvent<a>\n  | CacheEmptyEvent\n  | InitialValuePromiseLoadedEvent<a>\n  | ReductionEvent<b>;\n\ninterface LoadingEmitToSelf<a, b> {\n  currentValue: a;\n  pendingEvents: ReductionEvent<b>[];\n  kind: 'LoadingEmitToSelf';\n}\n\ninterface MismatchedReducer<a> {\n  currentValue: a;\n  kind: 'MismatchedReducer';\n}\n\ninterface LoadingFromCache<a, b> {\n  currentValue: a;\n  emitToSelf: (event: RealtimeEvent<a, b>) => void;\n  pendingEvents: ReductionEvent<b>[];\n  kind: 'LoadingFromCache';\n}\n\ninterface LoadingFromPromise<a, b> {\n  currentValue: a;\n  pendingEvents: ReductionEvent<b>[];\n  kind: 'LoadingFromPromise';\n}\n\ninterface SetFromInitialValue<a> {\n  currentValue: a;\n  kind: 'SetFromInitialValue';\n}\n\ninterface SetFromCacheOrReduction<a> {\n  currentValue: a;\n  ts: Timestamp;\n  kind: 'SetFromCacheOrReduction';\n}\n\ntype RealtimeReducerContext<a, b> =\n  | LoadingEmitToSelf<a, b>\n  | MismatchedReducer<a>\n  | LoadingFromCache<a, b>\n  | LoadingFromPromise<a, b>\n  | SetFromInitialValue<a>\n  | SetFromCacheOrReduction<a>;\n\n// retrieve the emitter's Promise's resolver function\n// and when called, delete it from the map\nfunction getResolver(eventId: number) {\n  const resolver = composeResolvers[eventId];\n  if (resolver) {\n    // eslint-disable-next-line\n    return (...args: any[]) => {\n      delete composeResolvers[eventId];\n      return resolver(...args);\n    };\n  } else {\n    return () => void 0;\n  }\n}\n\nfunction realtimeReducer<A, B, C>(\n  name: string,\n  reducer: (acc: A, curr: B, resolver?: (c: C) => void) => A,\n  initialValue: A | Promise<A>,\n  loadingValue: A,\n  context: RealtimeReducerContext<A, B>,\n  event: RealtimeEvent<A, B>\n): RealtimeReducerContext<A, B> {\n  const cacheOrLoadingValue = getCachedBehaviorLocalStorage(name) || loadingValue;\n  if (context.kind === 'MismatchedReducer') {\n    return context;\n  } else if (event.kind === 'MismatchedReducerEvent') {\n    return {\n      kind: 'MismatchedReducer',\n      currentValue: context.currentValue,\n    };\n  } else if (context.kind === 'LoadingEmitToSelf') {\n    if (event.kind === 'RegisterEmitToSelf') {\n      return {\n        emitToSelf: event.emitToSelf,\n        pendingEvents: context.pendingEvents,\n        currentValue: cacheOrLoadingValue,\n        kind: 'LoadingFromCache',\n      };\n    } else if (event.kind === 'ReductionEvent') {\n      return {\n        pendingEvents: context.pendingEvents.concat([event]),\n        currentValue: cacheOrLoadingValue,\n        kind: 'LoadingEmitToSelf',\n      };\n    } else {\n      return context;\n    }\n  } else if (event.kind === 'RegisterEmitToSelf') {\n    // no - op, because already registered\n    return context;\n  } else if (context.kind === 'LoadingFromCache') {\n    if (event.kind === 'CacheLoadedEvent') {\n      cacheBehaviorLocalStorage(name, event.currentValue, event.ts);\n      return {\n        currentValue: event.currentValue,\n        ts: event.ts,\n        kind: 'SetFromCacheOrReduction',\n      };\n    } else if (event.kind === 'CacheEmptyEvent') {\n      if (isPromise(initialValue)) {\n        (initialValue as Promise<A>).then((value) => {\n          context.emitToSelf({\n            currentValue: value,\n            kind: 'InitialValuePromiseLoadedEvent',\n          });\n        });\n        return {\n          currentValue: cacheOrLoadingValue,\n          pendingEvents: context.pendingEvents,\n          kind: 'LoadingFromPromise',\n        };\n      } else {\n        saveReducer(name, reducer.toString(), initialValue);\n        const newContext = context.pendingEvents.reduce(\n          (context: RealtimeReducerContext<A, B>, event) =>\n            realtimeReducer(name, reducer, initialValue, loadingValue, context, event),\n          {\n            currentValue: initialValue as A,\n            kind: 'SetFromInitialValue',\n          }\n        );\n        cacheBehaviorLocalStorage(name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n        emit('behaviors', name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n        return newContext;\n      }\n    } else if (event.kind === 'ReductionEvent') {\n      return {\n        ...context,\n        pendingEvents: context.pendingEvents.concat([event]),\n      };\n    } else {\n      return context;\n    }\n  } else if (context.kind === 'LoadingFromPromise') {\n    if (event.kind === 'InitialValuePromiseLoadedEvent') {\n      saveReducer(name, reducer.toString(), event.currentValue);\n      const newContext = context.pendingEvents.reduce(\n        (context: RealtimeReducerContext<A, B>, event) =>\n          realtimeReducer(name, reducer, initialValue, loadingValue, context, event),\n        {\n          currentValue: event.currentValue,\n          kind: 'SetFromInitialValue',\n        }\n      );\n      cacheBehaviorLocalStorage(name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n      emit('behaviors', name, newContext.currentValue, 'ts' in newContext && newContext.ts);\n      return newContext;\n    } else if (event.kind === 'ReductionEvent') {\n      return {\n        currentValue: cacheOrLoadingValue,\n        pendingEvents: context.pendingEvents.concat([event]),\n        kind: 'LoadingFromPromise',\n      };\n    } else {\n      return context;\n    }\n  } else if (context.kind === 'SetFromInitialValue') {\n    if (event.kind === 'ReductionEvent') {\n      const currentValue = reducer(context.currentValue, event.value, getResolver(event.id));\n      getResolver(event.id)(); // delete & resolve if not done in reducer\n      cacheBehaviorLocalStorage(name, currentValue, event.ts);\n      emit('behaviors', name, currentValue, event.ts);\n      return {\n        currentValue,\n        ts: event.ts,\n        kind: 'SetFromCacheOrReduction',\n      };\n    } else {\n      return context;\n    }\n  } else if (context.kind === 'SetFromCacheOrReduction') {\n    if (event.kind === 'ReductionEvent') {\n      if (event.ts.toMillis() > context.ts.toMillis()) {\n        const currentValue = reducer(context.currentValue, event.value, getResolver(event.id));\n        getResolver(event.id)(); // delete & resolve if not done in reducer\n        cacheBehaviorLocalStorage(name, currentValue, event.ts);\n        emit('behaviors', name, currentValue, event.ts);\n        return {\n          currentValue,\n          ts: event.ts,\n          kind: 'SetFromCacheOrReduction',\n        };\n      } else {\n        return context;\n      }\n    } else {\n      return context;\n    }\n  } else {\n    return context;\n  }\n}\n\nexport function useRealtimeReducer<A, B, C>({\n  name,\n  initialValue,\n  reducer,\n  loadingValue,\n}: {\n  name: string;\n  initialValue: A | Promise<A>;\n  reducer: (acc: A, curr: B, resolver?: (c: C) => void) => A;\n  loadingValue: A;\n}): [A, (b: B) => Promise<C>] {\n  const [realtimeContext, emitEvent] = useReducerSafe(\n    (context, event) => realtimeReducer(name, reducer, initialValue, loadingValue, context, event),\n    {\n      currentValue: loadingValue,\n      pendingEvents: [],\n      kind: 'LoadingEmitToSelf',\n    }\n  );\n  useEffect(\n    () =>\n      emitEvent({\n        emitToSelf: emitEvent,\n        kind: 'RegisterEmitToSelf',\n      }),\n    []\n  );\n\n  // confirm reducer and initial values are the same as the initial ones\n  useEffect(() => {\n    getDoc(doc(db, 'behaviors-reducers', name)).then((snapshot) => {\n      if (snapshot.exists()) {\n        const { reducerCode, initial } = snapshot.data();\n        if (reducerCode !== reducer.toString()) {\n          emitEvent({\n            kind: 'MismatchedReducer',\n          });\n          throw new Error(\n            `The reducer supplied to ${name} does not exactly match the reducer initially supplied. Bump the name and migrate over data from ${name} to create a new reducer.`\n          );\n        }\n        if (\n          !isPromise(initialValue) && // todo - find a way to provide this warning for promises\n          JSON.stringify(initial) !== JSON.stringify(initialValue)\n        ) {\n          throw new Error(`Initial value supplied to reducer ${name} is ignored because initial value already found`);\n        }\n      }\n    });\n  }, [name, initialValue, reducer, emitEvent]);\n\n  // get initial behavior from firebase cache\n  useEffect(() => {\n    const initialBehaviorFromCacheQuery = query(\n      collection(db, 'behaviors', name, 'values'),\n      orderBy('ts', 'desc'),\n      limit(1)\n    );\n    getDocs(initialBehaviorFromCacheQuery).then((querySnapshot) => {\n      const doc = querySnapshot.docs[0];\n      if (!doc) {\n        emitEvent({ kind: 'CacheEmptyEvent' });\n      } else if (!doc.metadata.hasPendingWrites) {\n        emitEvent({\n          kind: 'CacheLoadedEvent',\n          currentValue: doc.data().value,\n          ts: doc.data().ts,\n        });\n      }\n    });\n  }, [name, emitEvent]);\n\n  // subscribe to all new stream events to reduce upon\n  useEffect(() => {\n    const newStreamEventsQuery = query(collection(db, 'streams', name, 'values'), orderBy('ts', 'desc'), limit(1));\n    // It seems like this line might not be unsubscribing properly for React\n    // sometimes it causes a memory leak warning, but it may be a race condition\n    return onSnapshot(newStreamEventsQuery, (querySnapshot) => {\n      const doc = querySnapshot.docs[0];\n      if (doc && !doc.metadata.hasPendingWrites) {\n        emitEvent({\n          kind: 'ReductionEvent',\n          value: doc.data().value,\n          ts: doc.data().ts,\n          id: doc.data().id,\n        });\n      }\n    });\n  }, [name, emitEvent]);\n\n  return [realtimeContext.currentValue, (value) => emitWithResponse(name, value)];\n}\n","import { getRealtimeState, useFirebaseUser, useRealtimeReducer } from '../services/compose';\nimport { GenericErrors } from '../types/error';\nimport { Profile } from '../types/profile';\nimport { User } from '../types/user';\ninterface SignUpUserAction {\n  type: 'SIGN_UP';\n  user: User;\n}\ninterface UpdateUserAction {\n  type: 'UPDATE';\n  newUser: User;\n  uid: string;\n}\n\ntype UserAction = SignUpUserAction | UpdateUserAction;\n\nconst usersVersion = 103;\nexport const useUsers = () =>\n  useRealtimeReducer({\n    // <User[] | null, UserAction, GenericErrors>({\n    name: `conduit-users-${usersVersion}`,\n    initialValue: getRealtimeState(`conduit-users-${usersVersion - 1}`),\n    loadingValue: null,\n    reducer: (users, action, resolve) => {\n      let errors = {};\n      let returnValue = users;\n      if (action.type === 'SIGN_UP') {\n        if (users.some((u) => u.email === action.user.email)) {\n          errors['email'] = 'already in use';\n        }\n        if (users.some((u) => u.username === action.user.username)) {\n          errors['username'] = 'already in use';\n        }\n        if (users.some((u) => u.uid === action.user.uid)) {\n          errors['public-key'] = 'already in use';\n        }\n        if (!Object.keys(errors).length) {\n          returnValue = users.concat([action.user]);\n        }\n      } else if (action.type === 'UPDATE') {\n        if (action.uid) {\n          returnValue = users.map((u) => (u.uid === action.uid ? action.newUser : u));\n        } else {\n          errors['unauthorized'] = 'to perform update to user';\n        }\n      }\n      resolve(errors);\n      return returnValue;\n    },\n  });\n\nexport const useProfiles = (): Profile[] => {\n  const user = useUser();\n  const [users] = useUsers();\n  const [followers] = useFollowers();\n\n  return (\n    users &&\n    users.map((u) => ({\n      ...u,\n      following: user && followers && !!(followers[user.uid] || {})[u.uid],\n    }))\n  );\n};\n\nexport const useFollowers = () =>\n  useRealtimeReducer({\n    name: `conduit-followers-${usersVersion}`,\n    initialValue: getRealtimeState(`conduit-followers-${usersVersion - 1}`),\n    loadingValue: null,\n    reducer: (userFollowers, action, resolve) => {\n      const { follower, leader } = action;\n\n      if (action.uid !== follower) {\n        resolve({ errors: { unauthorized: 'to perform this action' } });\n        return userFollowers;\n      }\n\n      const following = action.type === 'FollowAction';\n\n      return {\n        ...userFollowers,\n        [follower]: {\n          ...(userFollowers[follower] || {}),\n          [leader]: following,\n        },\n      };\n    },\n  });\n\nexport const useUser = () => {\n  const firebaseUser = useFirebaseUser();\n  const [users] = useUsers();\n\n  return firebaseUser && users && users.find((user) => user.uid === firebaseUser.uid);\n};\n","import { useProfiles, useUser, useUsers } from './user';\nimport { emitWithResponse, getRealtimeState, useRealtimeReducer } from '../services/compose';\nimport { GenericErrors } from '../types/error';\nimport { Article, ArticleForEditor } from '../types/article';\n\ninterface CreateArticleAction {\n  type: 'CreateArticleAction';\n  article: ArticleForEditor;\n  uid: string;\n  slug: string;\n  createdAt: number;\n}\n\ninterface UpdateArticleAction {\n  type: 'UpdateArticleAction';\n  article: ArticleForEditor;\n  slug: string;\n  uid: string;\n  updatedAt: number;\n}\n\ninterface DeleteArticleAction {\n  type: 'DeleteArticleAction';\n  slug: string;\n  uid: string;\n}\n\ntype ArticleAction = CreateArticleAction | UpdateArticleAction | DeleteArticleAction;\n\nexport interface ArticleDB {\n  slug: string;\n  title: string;\n  description: string;\n  body: string;\n  createdAt: number;\n  updatedAt: number;\n  uid: string;\n}\n\ninterface ArticleResolve {\n  slug?: string;\n  errors?: GenericErrors;\n}\n\nconst articlesVersion = 110;\nexport const useArticlesDB = () =>\n  useRealtimeReducer({\n    // <ArticleDB[] | null, ArticleAction, ArticleResolve>(\n    name: `conduit-articles-${articlesVersion}`,\n    initialValue: getRealtimeState(`conduit-articles-${articlesVersion - 1}`),\n    loadingValue: null,\n    reducer: (articles, action, resolve) => {\n      let errors = {};\n      let returnValue = articles;\n      if (action.uid) {\n        if (action.type === 'CreateArticleAction') {\n          returnValue = articles.concat([\n            {\n              slug: action.slug,\n              title: action.article.title,\n              description: action.article.description,\n              body: action.article.body,\n              createdAt: action.createdAt,\n              updatedAt: action.createdAt,\n              uid: action.uid,\n            },\n          ]);\n          updateArticleTags({ slug: action.slug, tagList: action.article.tagList });\n        } else if (action.type === 'UpdateArticleAction') {\n          // TODO - only do if action.uid matches\n          returnValue = articles.map((article) =>\n            article.slug == action.slug && article.uid === action.uid\n              ? {\n                  ...article,\n                  title: action.article.title,\n                  description: action.article.description,\n                  body: action.article.body,\n                  updatedAt: action.updatedAt,\n                }\n              : article\n          );\n          updateArticleTags({ slug: action.slug, tagList: action.article.tagList });\n        } else if (action.type === 'DeleteArticleAction') {\n          // TODO - only do if action.uid matches\n          if (articles.find((a) => a.slug == action.slug).uid === action.uid) {\n            returnValue = articles.filter((article) => article.slug !== action.slug);\n          }\n        }\n      } else {\n        errors['unauthorized'] = ['to edit article'];\n      }\n      if (Object.keys(errors).length) {\n        resolve({ errors });\n      } else {\n        resolve({ slug: action.slug });\n      }\n\n      return returnValue;\n    },\n  });\ninterface ArticleTag {\n  slug: string;\n  tag: string;\n}\n\ninterface UpdateArticleTags {\n  type: 'UpdateArticleTags';\n  slug: string;\n  tagList: string[];\n  uid: string;\n}\n\ntype ArticleTagAction = UpdateArticleTags;\n\nexport const useArticleTags = () =>\n  useRealtimeReducer({\n    //<ArticleTag[] | null, ArticleTagAction, GenericErrors>(\n    name: `conduit-tags-${articlesVersion}`,\n    initialValue: [], //getRealtimeState(`conduit-tags-${articlesVersion - 1}`),\n    loadingValue: null,\n    reducer: (articleTagsOption, action, resolve) => {\n      let errors = {};\n      let returnValue = articleTagsOption as ArticleTag[]; // TODO rearchitect this around lookups like favorites?\n      if (action.uid === 'TODO') {\n        if (action.type === 'UpdateArticleTags') {\n          returnValue = returnValue.filter((pt) => pt.slug !== action.slug || action.tagList.includes(pt.tag));\n          returnValue = returnValue.concat(\n            action.tagList\n              .filter((tag) => !returnValue.some((pt) => pt.slug === action.slug && pt.tag === tag))\n              .map((tag) => ({ tag, slug: action.slug }))\n          );\n        }\n      } else {\n        errors['unauthorized'] = 'to edit article';\n      }\n      resolve(errors);\n      return returnValue;\n    },\n  });\n\nexport const useTags = () => {\n  const [articleTags] = useArticleTags();\n  return articleTags && Array.from(new Set(articleTags.map(({ tag }) => tag)));\n};\n\n// TODO - what's going on with this function...?\nfunction updateArticleTags(payload: { slug: string; tagList: string[] }) {\n  return emitWithResponse(`conduit-tags-${articlesVersion}`, { ...payload, type: 'UpdateArticleTags' });\n}\n\nexport const useArticleFavorites = () =>\n  useRealtimeReducer({\n    name: `conduit-favorites-${articlesVersion}`,\n    initialValue: { articles: {}, users: {} }, //getRealtimeState(`conduit-favorites-${articlesVersion - 5}`),\n    loadingValue: null,\n    reducer: ({ articles, users }, action, resolve) => {\n      if (!action.uid) {\n        resolve({ errors: { unauthorized: 'to perform this action' } });\n        return { articles, users };\n      }\n\n      const { slug, uid } = action;\n      const favorite = action.type === 'FavoriteAction';\n\n      return {\n        articles: {\n          ...articles,\n          [slug]: {\n            ...(articles[slug] || {}),\n            [uid]: favorite,\n          },\n        },\n        users: {\n          ...users,\n          [uid]: {\n            ...(users[uid] || {}),\n            [slug]: favorite,\n          },\n        },\n      };\n    },\n  });\n\nexport const useArticles = (): Article[] => {\n  const user = useUser();\n  const [articlesDB] = useArticlesDB();\n  const [articleTags] = useArticleTags();\n  const [articleFavorites] = useArticleFavorites();\n  const authors = useProfiles();\n\n  const articles =\n    articlesDB &&\n    articleTags &&\n    authors &&\n    articleFavorites &&\n    articlesDB.map((articleDB) => ({\n      slug: articleDB.slug,\n      title: articleDB.title,\n      description: articleDB.description,\n      body: articleDB.body,\n      tagList: articleTags.filter((articleTag) => articleTag.slug === articleDB.slug).map(({ tag }) => tag),\n      createdAt: new Date(articleDB.createdAt),\n      updatedAt: new Date(articleDB.updatedAt),\n      favorited:\n        user && articleFavorites.articles[articleDB.slug] && articleFavorites.articles[articleDB.slug][user.uid],\n      favoritesCount: Object.values(articleFavorites.articles[articleDB.slug] || {}).filter((favorite) => favorite)\n        .length,\n      author: authors.find((u) => u.uid === articleDB.uid),\n    }));\n\n  return articles;\n};\nexport const useArticleCommentsDB = () =>\n  useRealtimeReducer({\n    name: `conduit-comments-${articlesVersion}`,\n    initialValue: getRealtimeState(`conduit-comments-${articlesVersion - 1}`),\n    loadingValue: null,\n    reducer: (comments, action, resolve) => {\n      if (!action.uid) {\n        resolve({ errors: { unauthorized: 'to perform this action' } });\n        return comments;\n      }\n\n      const { slug, uid, commentId } = action;\n\n      if (action.type === 'CreateComment') {\n        const { body, createdAt } = action;\n        return {\n          ...comments,\n          [slug]: [...(comments[slug] || []), { uid, commentId, body, createdAt }],\n        };\n      } else if (action.type === 'DeleteComment') {\n        const comment = comments[slug].find((c) => c.commentId === commentId);\n        if (comment && comment.uid === action.uid) {\n          return {\n            ...comments,\n            [slug]: [...(comments[slug] || []).filter((c) => c.commentId !== commentId)],\n          };\n        } else {\n          resolve({ errors: { unauthorized: 'to perform this action' } });\n          return comments;\n        }\n      } else {\n        return comments;\n      }\n    },\n  });\n\nexport const useArticleComments = () => {\n  const [comments] = useArticleCommentsDB();\n  const [users] = useUsers();\n\n  return (\n    comments &&\n    users &&\n    Object.fromEntries(\n      Object.entries(comments).map(([slug, comments]) => [\n        slug,\n        comments.map((comment) => ({\n          ...comment,\n          createdAt: new Date(comment.createdAt),\n          author: users.find((u) => u.uid === comment.uid),\n        })),\n      ])\n    )\n  );\n};\n","export function redirect(path: string) {\n  location.hash = `#/${path}`;\n}\n","export interface GenericFormField {\n  name: string;\n  type: string;\n  placeholder: string;\n  rows?: number;\n  fieldType: 'input' | 'textarea' | 'list';\n  listName?: string;\n  lg: boolean;\n}\n\nexport function buildGenericFormField(data: Partial<GenericFormField> & { name: string }): GenericFormField {\n  return {\n    type: 'text',\n    placeholder: '',\n    fieldType: 'input',\n    lg: true,\n    ...data,\n  };\n}\n","export function ContainerPage({ children }: { children: JSX.Element | JSX.Element[] }) {\n  return (\n    <div className='container page'>\n      <div className='row'> {children} </div>\n    </div>\n  );\n}\n","import React from 'react';\n\nexport function FormGroup({\n  type,\n  placeholder,\n  disabled,\n  value,\n  onChange,\n  lg,\n}: {\n  type: string;\n  placeholder: string;\n  disabled: boolean;\n  value: string;\n  lg: boolean;\n  onChange: (ev: React.ChangeEvent<HTMLInputElement>) => void;\n}) {\n  return (\n    <fieldset className='form-group'>\n      <input\n        className={`form-control${!lg ? '' : ' form-control-lg'}`}\n        {...{ type, placeholder, disabled, value, onChange }}\n      />\n    </fieldset>\n  );\n}\n\nexport function TextAreaFormGroup({\n  type,\n  placeholder,\n  disabled,\n  value,\n  rows,\n  onChange,\n  lg,\n}: {\n  type: string;\n  placeholder: string;\n  disabled: boolean;\n  rows: number;\n  value: string;\n  lg: boolean;\n  onChange: (ev: React.ChangeEvent<HTMLTextAreaElement>) => void;\n}) {\n  return (\n    <fieldset className='form-group'>\n      <textarea\n        className={`form-control${!lg ? '' : ' form-control-lg'}`}\n        {...{ type, placeholder, disabled, value, onChange, rows }}\n      ></textarea>\n    </fieldset>\n  );\n}\n\nexport function ListFormGroup({\n  type,\n  placeholder,\n  disabled,\n  value,\n  listValue,\n  lg,\n  onChange,\n  onEnter,\n  onRemoveItem,\n}: {\n  type: string;\n  placeholder: string;\n  disabled: boolean;\n  value: string;\n  listValue: string[];\n  lg: boolean;\n  onChange: (ev: React.ChangeEvent<HTMLInputElement>) => void;\n  onEnter: () => void;\n  onRemoveItem: (index: number) => void;\n}) {\n  return (\n    <fieldset className='form-group'>\n      <input\n        className={`form-control${!lg ? '' : ' form-control-lg'}`}\n        {...{ type, placeholder, disabled, value, onChange }}\n        onKeyDown={(ev) => ev.key === 'Enter' && ev.preventDefault()}\n        onKeyUp={onListFieldKeyUp(onEnter)}\n      />\n      <div className='tag-list'>\n        {listValue &&\n          listValue.map((value, index) => (\n            <span key={value} className='tag-default tag-pill' onClick={() => onRemoveItem(index)}>\n              <i className='ion-close-round'></i>\n              {value}\n            </span>\n          ))}\n      </div>\n    </fieldset>\n  );\n}\n\nexport function onListFieldKeyUp(onEnter: () => void): (ev: React.KeyboardEvent) => void {\n  return (ev) => {\n    if (ev.key === 'Enter') {\n      ev.preventDefault();\n      onEnter();\n    }\n  };\n}\n","import { GenericErrors } from '../types/error';\n\nexport function Errors({ errors }: { errors: GenericErrors }) {\n  return (\n    <ul className='error-messages'>\n      {Object.entries(errors).map(([field, fieldErrors]) =>\n        fieldErrors.map((fieldError) => (\n          <li key={field + fieldError}>\n            {field} {fieldError}\n          </li>\n        ))\n      )}\n    </ul>\n  );\n}\n","import { FC, Fragment } from 'react';\nimport { FormGroup, ListFormGroup, TextAreaFormGroup } from './FormGroup';\nimport { GenericFormField } from '../types/genericFormField';\nimport { GenericErrors } from '../types/error';\nimport { Errors } from './Errors';\n\nexport interface GenericFormProps {\n  fields: GenericFormField[];\n  disabled: boolean;\n  formObject: Record<string, string | null>;\n  submitButtonText: string;\n  errors: GenericErrors;\n  onChange: (name: string, value: string) => void;\n  onSubmit: (ev: React.FormEvent) => void;\n  onAddItemToList?: (name: string) => void;\n  onRemoveListItem?: (name: string, index: number) => void;\n}\n\nexport const GenericForm: FC<GenericFormProps> = ({\n  fields,\n  disabled,\n  formObject,\n  submitButtonText,\n  errors,\n  onChange,\n  onSubmit,\n  onAddItemToList,\n  onRemoveListItem,\n}) => (\n  <Fragment>\n    <Errors errors={errors} />\n\n    <form onSubmit={onSubmit}>\n      <fieldset>\n        {fields.map((field) =>\n          field.fieldType === 'input' ? (\n            <FormGroup\n              key={field.name}\n              disabled={disabled}\n              type={field.type}\n              placeholder={field.placeholder}\n              value={formObject[field.name] || ''}\n              onChange={onUpdateField(field.name, onChange)}\n              lg={field.lg}\n            />\n          ) : field.fieldType === 'textarea' ? (\n            <TextAreaFormGroup\n              key={field.name}\n              disabled={disabled}\n              type={field.type}\n              placeholder={field.placeholder}\n              value={formObject[field.name] || ''}\n              rows={field.rows as number}\n              onChange={onUpdateField(field.name, onChange)}\n              lg={field.lg}\n            />\n          ) : (\n            <ListFormGroup\n              key={field.name}\n              disabled={disabled}\n              type={field.type}\n              placeholder={field.placeholder}\n              value={formObject[field.name] || ''}\n              onChange={onUpdateField(field.name, onChange)}\n              listValue={formObject[field.listName as string] as unknown as string[]}\n              onEnter={() => onAddItemToList && field.listName && onAddItemToList(field.listName)}\n              onRemoveItem={(index) => onRemoveListItem && field.listName && onRemoveListItem(field.listName, index)}\n              lg={field.lg}\n            />\n          )\n        )}\n        <button className='btn btn-lg btn-primary pull-xs-right'>{submitButtonText}</button>\n      </fieldset>\n    </form>\n  </Fragment>\n);\n\nfunction onUpdateField(\n  name: string,\n  onChange: GenericFormProps['onChange']\n): (ev: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => void {\n  return ({ target: { value } }) => {\n    onChange(name, value);\n  };\n}\n","import { useState } from 'react';\nimport { ArticleForEditor } from './../types/article';\nimport { GenericErrors } from './../types/error';\nimport { buildGenericFormField } from './../types/genericFormField';\nimport { ContainerPage } from './ContainerPage';\nimport { GenericForm } from './GenericForm';\n\nexport function ArticleEditor({\n  onSubmit,\n  submitting,\n  article,\n  errors,\n}: {\n  onSubmit: (newArticle: ArticleForEditor) => void;\n  submitting: boolean;\n  article?: ArticleForEditor;\n  errors: GenericErrors;\n}) {\n  const [currentArticle, setCurrentArticle] = useState(article);\n  const [tagTextbox, setTagTextbox] = useState('');\n\n  function onUpdateField(name: string, value: string) {\n    if (name === 'tag') {\n      setTagTextbox(value);\n    } else if (name !== 'tagList') {\n      setCurrentArticle({\n        ...currentArticle,\n        [name]: value,\n      });\n    }\n  }\n\n  function onAddTag() {\n    setCurrentArticle({\n      ...currentArticle,\n      tagList: currentArticle.tagList.concat([tagTextbox]),\n    });\n  }\n\n  function onRemoveTag(_: string, index: number) {\n    setCurrentArticle({\n      ...currentArticle,\n      tagList: currentArticle.tagList.filter((_, i) => i !== index),\n    });\n  }\n\n  return (\n    <div className='editor-page'>\n      <ContainerPage>\n        <div className='col-md-10 offset-md-1 col-xs-12'>\n          <GenericForm\n            formObject={{ ...currentArticle, tag: tagTextbox } as unknown as Record<string, string | null>}\n            disabled={submitting}\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={(ev) => {\n              ev.preventDefault();\n              onSubmit(currentArticle);\n            }}\n            submitButtonText='Publish Article'\n            onAddItemToList={onAddTag}\n            onRemoveListItem={onRemoveTag}\n            fields={[\n              buildGenericFormField({ name: 'title', placeholder: 'Article Title' }),\n              buildGenericFormField({ name: 'description', placeholder: \"What's this article about?\", lg: false }),\n              buildGenericFormField({\n                name: 'body',\n                placeholder: 'Write your article (in markdown)',\n                fieldType: 'textarea',\n                rows: 8,\n                lg: false,\n              }),\n              buildGenericFormField({\n                name: 'tag',\n                placeholder: 'Enter Tags',\n                listName: 'tagList',\n                fieldType: 'list',\n                lg: false,\n              }),\n            ]}\n          />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import { Fragment, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { useArticles, useArticlesDB } from '../../services/article';\nimport { useUser } from '../../services/user';\nimport { redirect } from '../../types/location';\nimport { ArticleEditor } from '../ArticleEditor';\n\nexport function EditArticle() {\n  const { slug } = useParams<{ slug: string }>();\n  const user = useUser();\n\n  const [, emitArticlesAction] = useArticlesDB();\n\n  const articles = useArticles();\n  const article = articles && articles.find((a) => a.slug === slug);\n\n  const [submitting, setSubmitting] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  if (article && user && article.author.uid !== user.uid) {\n    redirect('');\n    return;\n  }\n\n  async function onSubmit(newArticle) {\n    setSubmitting(true);\n\n    if (!user) {\n      redirect('');\n    }\n\n    const { errors } = await emitArticlesAction({\n      type: 'UpdateArticleAction',\n      article: newArticle,\n      slug,\n      uid: user.uid,\n      updatedAt: Date.now(),\n    });\n\n    setSubmitting(false);\n\n    if (errors) {\n      setErrors(errors);\n    } else {\n      redirect(`article/${slug}`);\n    }\n  }\n\n  return (\n    <Fragment>\n      {article && <ArticleEditor onSubmit={onSubmit} submitting={submitting} article={article} errors={errors} />}\n    </Fragment>\n  );\n}\n","import { Link } from 'react-router-dom';\n\nexport function Footer() {\n  return (\n    <footer>\n      <div className='container'>\n        <Link to='' className='logo-font'>\n          conduit\n        </Link>\n        <span className='attribution'>\n          An interactive learning project from <a href='https://thinkster.io'>Thinkster</a>. Code &amp; design licensed\n          under MIT.\n        </span>\n      </div>\n    </footer>\n  );\n}\n","import { Fragment } from 'react';\nimport { HashRouter, NavLink } from 'react-router-dom';\nimport { useUser } from '../services/user';\nimport { User } from '../types/user';\nimport { Link } from 'react-router-dom';\n\nexport function Header() {\n  const user = useUser();\n\n  return (\n    <nav className='navbar navbar-light'>\n      <div className='container'>\n        <Link className='navbar-brand' to=''>\n          conduit\n        </Link>\n        <ul className='nav navbar-nav pull-xs-right'>\n          <HashRouter>\n            <NavItem text='Home' href='' />\n\n            {user ? <UserLinks user={user} /> : <GuestLinks />}\n          </HashRouter>\n        </ul>\n      </div>\n    </nav>\n  );\n}\n\nfunction NavItem({ text, href, icon }: { text: string; href: string; icon?: string }) {\n  return (\n    <li className='nav-item'>\n      <NavLink exact to={href} activeClassName='active' className='nav-link'>\n        {icon && <i className={icon}></i>}&nbsp;\n        {text}\n      </NavLink>\n    </li>\n  );\n}\n\nfunction GuestLinks() {\n  return (\n    <Fragment>\n      <NavItem text='Sign in' href='/login' />\n      <NavItem text='Sign up' href='/register' />\n    </Fragment>\n  );\n}\n\nfunction UserLinks({ user: { username } }: { user: User }) {\n  return (\n    <Fragment>\n      <NavItem text='New Article' href='/editor' icon='ion-compose' />\n      <NavItem text='Settings' href='/settings' icon='ion-gear-a' />\n      <NavItem text={`${username}`} href={`/profile/${username}`} />\n    </Fragment>\n  );\n}\n","export function classObjectToClassName(obj: Record<string, boolean>): string {\n  return Object.entries(obj)\n    .filter(([, active]) => active)\n    .map(([name]) => name)\n    .join(' ');\n}\n","import { format } from 'date-fns';\nimport { useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport { Article } from '../types/article';\nimport { useUser } from '../services/user';\nimport { useArticleFavorites } from '../services/article';\n\nexport function ArticlePreview({\n  article: {\n    createdAt,\n    favorited,\n    favoritesCount,\n    slug,\n    title,\n    description,\n    tagList,\n    author: { image = '', username = '' },\n  },\n}: {\n  article: Article;\n}) {\n  const user = useUser();\n  const [isSubmitting, setSubmitting] = useState(false);\n\n  const [, emitFavoriteAction] = useArticleFavorites();\n\n  async function onFavoriteToggle() {\n    if (!user) return;\n\n    setSubmitting(true);\n\n    await emitFavoriteAction({\n      type: favorited ? 'UnfavoriteAction' : 'FavoriteAction',\n      slug,\n      uid: user.uid,\n    });\n\n    setSubmitting(false);\n  }\n\n  return (\n    <div className='article-preview'>\n      <div className='article-meta'>\n        <Link to={`/profile/${username}`} className='author'>\n          <img src={image || undefined} />\n        </Link>\n        <div className='info'>\n          <Link to={`/profile/${username}`} className='author'>\n            {username}\n          </Link>\n          <span className='date'>{format(createdAt, 'PP')}</span>\n        </div>\n        <button\n          className={`btn btn-sm pull-xs-right ${favorited ? 'btn-primary' : 'btn-outline-primary'}`}\n          aria-label='Toggle Favorite'\n          disabled={isSubmitting}\n          onClick={onFavoriteToggle}\n        >\n          <i className='ion-heart'></i> {favoritesCount}\n        </button>\n      </div>\n      <Link to={`article/${slug}`} className='preview-link'>\n        <h1>{title}</h1>\n        <p>{description}</p>\n        <span>Read more...</span>\n        <TagList tagList={tagList} />\n      </Link>\n    </div>\n  );\n}\n\nexport function TagList({ tagList }: { tagList: string[] }) {\n  return (\n    <ul className='tag-list'>\n      {tagList.map((tag) => (\n        <li key={tag} className='tag-default tag-pill tag-outline'>\n          {tag}\n        </li>\n      ))}\n    </ul>\n  );\n}\n","import { range } from 'ramda';\n\nexport function Pagination({\n  currentPage,\n  count,\n  itemsPerPage,\n  onPageChange,\n}: {\n  currentPage: number;\n  count: number;\n  itemsPerPage: number;\n  onPageChange?: (index: number) => void;\n}) {\n  return (\n    <nav>\n      <ul className='pagination'>\n        {Math.ceil(count / itemsPerPage) > 1 &&\n          range(1, Math.ceil(count / itemsPerPage) + 1).map((index) => (\n            <li\n              key={index}\n              className={`page-item${currentPage !== index ? '' : ' active'}`}\n              onClick={onPageChange && (() => onPageChange(index))}\n            >\n              <a className='page-link' aria-label={`Go to page number ${index}`} href='#'>\n                {index}\n              </a>\n            </li>\n          ))}\n      </ul>\n    </nav>\n  );\n}\n","import { Fragment, useState } from 'react';\nimport { classObjectToClassName } from './../types/style';\nimport { useFollowers, useUser } from './../services/user';\nimport { ArticlePreview } from './ArticlePreview';\nimport { Pagination } from './Pagination';\nimport { useArticleFavorites, useArticles } from '../services/article';\n\nexport function ArticlesViewer({\n  toggleClassName,\n  tabs,\n  selectedTab,\n  onTabChange,\n  uid,\n}: {\n  toggleClassName: string;\n  tabs: string[];\n  selectedTab: string;\n  onTabChange?: (tab: string) => void;\n  uid?: string;\n}) {\n  const [currentPage, setCurrentPage] = useState(1);\n  const user = useUser();\n  const articles = useArticles();\n  const [following] = useFollowers();\n  const [favorites] = useArticleFavorites();\n\n  const feedArticles =\n    articles &&\n    articles\n      .filter(\n        (article) =>\n          selectedTab === 'Global Feed' ||\n          (selectedTab === 'Your Feed' && user && following[user.uid] && following[user.uid][article.author.uid]) ||\n          (selectedTab === 'My Articles' && article.author.uid === uid) ||\n          (selectedTab === 'Favorited Articles' && favorites.users[uid] && favorites.users[uid][article.slug])\n      )\n      .sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\n\n  const pageArticles = feedArticles && feedArticles.slice((currentPage - 1) * 10, currentPage * 10);\n  const articlesCount = feedArticles ? feedArticles.length : 0;\n\n  return (\n    <Fragment>\n      <ArticlesTabSet {...{ tabs, selectedTab, toggleClassName, onTabChange }} />\n      <ArticleList articles={pageArticles} />\n      <Pagination currentPage={currentPage} count={articlesCount} itemsPerPage={10} onPageChange={setCurrentPage} />\n    </Fragment>\n  );\n}\n\nfunction ArticlesTabSet({\n  tabs,\n  toggleClassName,\n  selectedTab,\n  onTabChange,\n}: {\n  tabs: string[];\n  toggleClassName: string;\n  selectedTab: string;\n  onTabChange?: (tab: string) => void;\n}) {\n  return (\n    <div className={toggleClassName}>\n      <ul className='nav nav-pills outline-active'>\n        {tabs.map((tab) => (\n          <Tab key={tab} tab={tab} active={tab === selectedTab} onClick={() => onTabChange && onTabChange(tab)} />\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nfunction Tab({ tab, active, onClick }: { tab: string; active: boolean; onClick: () => void }) {\n  return (\n    <li className='nav-item'>\n      <a\n        className={classObjectToClassName({ 'nav-link': true, active })}\n        href='#'\n        onClick={(ev) => {\n          ev.preventDefault();\n          onClick();\n        }}\n      >\n        {tab}\n      </a>\n    </li>\n  );\n}\n\nfunction ArticleList({ articles }) {\n  return articles ? (\n    <Fragment>\n      {articles.length === 0 && (\n        <div className='article-preview' key={1}>\n          No articles are here... yet.\n        </div>\n      )}\n      {articles.map((article, index) => (\n        <ArticlePreview key={article.slug} article={article} />\n      ))}\n    </Fragment>\n  ) : (\n    <div className='article-preview' key={1}>\n      Loading articles...\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { useTags } from '../../services/article';\nimport { useUser } from '../../services/user';\nimport { ArticlesViewer } from '../ArticlesViewer';\nimport { ContainerPage } from '../ContainerPage';\n\nexport function Home() {\n  const user = useUser();\n  const [selectedTab, setSelectedTab] = useState(user ? 'Your Feed' : 'Global Feed');\n\n  // TODO - do I need to wrap setSelectedTab to also modify the URL hash? (look at the previous version)\n\n  return (\n    <div className='home-page'>\n      {renderBanner()}\n      <ContainerPage>\n        <div className='col-md-9'>\n          <ArticlesViewer\n            toggleClassName='feed-toggle'\n            selectedTab={selectedTab}\n            tabs={buildTabsNames(selectedTab)}\n            onTabChange={setSelectedTab}\n          />\n        </div>\n\n        <div className='col-md-3'>\n          <HomeSidebar setSelectedTab={setSelectedTab} />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n\nfunction renderBanner() {\n  return (\n    <div className='banner'>\n      <div className='container'>\n        <h1 className='logo-font'>conduit</h1>\n        <p>A place to share your knowledge.</p>\n      </div>\n    </div>\n  );\n}\n\nfunction buildTabsNames(selectedTab: string) {\n  const user = useUser();\n  return Array.from(new Set([...(user ? ['Your Feed'] : []), 'Global Feed']));\n}\n\nfunction HomeSidebar({ setSelectedTab }) {\n  const tags = useTags();\n\n  return (\n    <div className='sidebar'>\n      <p>Popular Tags</p>\n\n      {tags ? (\n        <div className='tag-list'>\n          {' '}\n          {tags.map((tag) => (\n            <a key={tag} href='#' className='tag-pill tag-default' onClick={() => setSelectedTab(tag)}>\n              {tag}\n            </a>\n          ))}{' '}\n        </div>\n      ) : (\n        <span>Loading tags...</span>\n      )}\n    </div>\n  );\n}\n","import { signInWithEmailAndPassword } from 'firebase/auth';\nimport React, { useState } from 'react';\nimport { buildGenericFormField } from './../../types/genericFormField';\nimport { GenericForm } from './../GenericForm';\nimport { ContainerPage } from './../ContainerPage';\nimport { useUsers } from '../../services/user';\nimport { firebaseAuth } from '../../services/compose';\nimport { redirect } from '../../types/location';\nimport { Link } from 'react-router-dom';\n\nexport function Login() {\n  const [users] = useUsers();\n\n  const [loggingIn, setLoggingIn] = useState(false);\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [errors, setErrors] = useState({});\n\n  async function signIn(ev: React.FormEvent) {\n    ev.preventDefault();\n\n    setLoggingIn(true);\n\n    const user = users.find((u) => u.email === email);\n    if (!user) {\n      setErrors({ email: ['not found'] });\n      setLoggingIn(false);\n      return;\n    }\n\n    try {\n      await signInWithEmailAndPassword(firebaseAuth, user.email, password);\n      redirect('');\n    } catch (e) {\n      setErrors({ login: [e.message] });\n    }\n\n    setLoggingIn(false);\n  }\n\n  function onUpdateField(name: string, value: string) {\n    if (name === 'email') {\n      setEmail(value);\n    } else if (name === 'password') {\n      setPassword(value);\n    }\n  }\n\n  return (\n    <div className='auth-page'>\n      <ContainerPage>\n        <div className='col-md-6 offset-md-3 col-xs-12'>\n          <h1 className='text-xs-center'>Sign in</h1>\n          <p className='text-xs-center'>\n            <Link to='/#/register'>Need an account?</Link>\n          </p>\n\n          <GenericForm\n            disabled={loggingIn}\n            formObject={{ email, password }}\n            submitButtonText='Sign in'\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={signIn}\n            fields={[\n              buildGenericFormField({ name: 'email', placeholder: 'Email' }),\n              buildGenericFormField({ name: 'password', placeholder: 'Password', type: 'password' }),\n            ]}\n          />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { ArticleForEditor } from './../../types/article';\nimport { useArticlesDB } from './../../services/article';\nimport { useUser } from './../../services/user';\nimport { ArticleEditor } from './../ArticleEditor';\nimport { redirect } from '../../types/location';\n\nexport function NewArticle() {\n  const user = useUser();\n  const [, emitArticleAction] = useArticlesDB();\n\n  const [submitting, setSubmitting] = useState(false);\n  const [errors, setErrors] = useState({});\n\n  async function onSubmit(newArticle: ArticleForEditor) {\n    setSubmitting(true);\n    try {\n      const { errors, slug } = await emitArticleAction({\n        type: 'CreateArticleAction',\n        article: newArticle,\n        createdAt: Date.now(),\n        uid: user.uid,\n        slug: Math.random().toString(), // TODO - better slug\n      });\n\n      setSubmitting(false);\n\n      if (errors) {\n        setErrors(errors);\n      } else {\n        redirect(`article/${slug}`);\n      }\n    } catch (e) {\n      setErrors({ 'unknown network error': e.message });\n    }\n  }\n\n  return <ArticleEditor onSubmit={onSubmit} errors={errors} submitting={submitting} />;\n}\n","import { createUserWithEmailAndPassword } from 'firebase/auth';\nimport { buildGenericFormField } from './../../types/genericFormField';\nimport { GenericForm } from './../GenericForm';\nimport { useUsers } from './../../services/user';\nimport { ContainerPage } from './../ContainerPage';\nimport { useState } from 'react';\nimport { firebaseAuth } from '../../services/compose';\nimport { redirect } from '../../types/location';\nimport { Link } from 'react-router-dom';\n\nexport function Register() {\n  const [errors, setErrors] = useState({});\n  const [signingUp, setSigningUp] = useState(false);\n  const [user, setUser] = useState({ username: '', email: '', password: '' });\n\n  const [users, emitUserAction] = useUsers();\n\n  function onUpdateField(name: string, value: string) {\n    setUser({ ...user, [name]: value });\n  }\n\n  async function onSignUp(ev: React.FormEvent) {\n    ev.preventDefault();\n    setSigningUp(true);\n\n    try {\n      const {\n        user: { uid },\n      } = await createUserWithEmailAndPassword(firebaseAuth, user.email, user.password);\n      const errors = await emitUserAction({\n        type: 'SIGN_UP',\n        user: {\n          username: user.username,\n          email: user.email,\n          uid,\n          bio: null,\n          image: null,\n        },\n      });\n\n      if (Object.keys(errors).length) {\n        setErrors(errors);\n      } else {\n        redirect('');\n      }\n    } catch (e) {\n      setErrors({ register: [e.message] });\n    }\n\n    setSigningUp(false);\n  }\n\n  return (\n    <div className='auth-page'>\n      <ContainerPage>\n        <div className='col-md-6 offset-md-3 col-xs-12'>\n          <h1 className='text-xs-center'>Sign up</h1>\n          <p className='text-xs-center'>\n            <Link to='login'>Have an account?</Link>\n          </p>\n\n          <GenericForm\n            disabled={signingUp}\n            formObject={user as unknown as Record<string, string>}\n            submitButtonText='Sign up'\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={onSignUp}\n            fields={[\n              buildGenericFormField({ name: 'username', placeholder: 'Username' }),\n              buildGenericFormField({ name: 'email', placeholder: 'Email' }),\n              buildGenericFormField({ name: 'password', placeholder: 'Password', type: 'password' }),\n            ]}\n          />\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { useUser, useUsers } from './../../services/user';\nimport { buildGenericFormField } from './../../types/genericFormField';\nimport { GenericForm } from './../GenericForm';\nimport { ContainerPage } from './../ContainerPage';\nimport { UserSettings } from '../../types/user';\nimport { signOut } from 'firebase/auth';\nimport { firebaseAuth } from '../../services/compose';\nimport { redirect } from '../../types/location';\n\nexport interface SettingsField {\n  name: keyof UserSettings;\n  type?: string;\n  isTextArea?: true;\n  placeholder: string;\n}\n\nexport function Settings() {\n  const oldUser = useUser();\n  const [newUser, setUser] = useState(null);\n  const [errors, setErrors] = useState({});\n  const [updating, setUpdating] = useState(false);\n\n  const user = newUser || (oldUser ? oldUser : {});\n\n  function onUpdateField(name: string, value: string) {\n    setUser({ ...user, [name]: value });\n  }\n\n  const [, emitUserAction] = useUsers();\n\n  async function onUpdateSettings(ev: React.FormEvent) {\n    ev.preventDefault();\n    if (!oldUser) {\n      return;\n    }\n\n    setUpdating(true);\n    // TODO if email change, do that in firebase auth\n\n    const errors = await emitUserAction({\n      type: 'UPDATE',\n      uid: oldUser.uid,\n      newUser: user,\n    });\n    setUpdating(false);\n    if (Object.keys(errors).length) {\n      setErrors(errors);\n    } else {\n      redirect('');\n    }\n  }\n\n  return (\n    <div className='settings-page'>\n      <ContainerPage>\n        <div className='col-md-6 offset-md-3 col-xs-12'>\n          <h1 className='text-xs-center'>Your Settings</h1>\n\n          <GenericForm\n            disabled={updating}\n            formObject={{ ...user }}\n            submitButtonText='Update Settings'\n            errors={errors}\n            onChange={onUpdateField}\n            onSubmit={onUpdateSettings}\n            fields={[\n              buildGenericFormField({ name: 'image', placeholder: 'URL of profile picture' }),\n              buildGenericFormField({ name: 'username', placeholder: 'Your Name' }),\n              buildGenericFormField({\n                name: 'bio',\n                placeholder: 'Short bio about you',\n                rows: 8,\n                fieldType: 'textarea',\n              }),\n              buildGenericFormField({ name: 'email', placeholder: 'Email' }),\n              buildGenericFormField({ name: 'password', placeholder: 'Password', type: 'password' }),\n            ]}\n          />\n\n          <hr />\n          <button className='btn btn-outline-danger' onClick={() => signOut(firebaseAuth)}>\n            Or click here to logout.\n          </button>\n        </div>\n      </ContainerPage>\n    </div>\n  );\n}\n","import { Profile } from '../types/profile';\nimport { useUser } from '../services/user';\n\nexport function UserInfo({\n  user: { image, username, bio, following },\n  disabled,\n  onFollowToggle,\n  onEditSettings,\n}: {\n  user: Profile;\n  disabled: boolean;\n  onFollowToggle?: () => void;\n  onEditSettings?: () => void;\n}) {\n  const user = useUser();\n  const sessionUsername = user ? user.username : '';\n\n  return (\n    <div className='user-info'>\n      <div className='container'>\n        <div className='row'>\n          <div className='col-xs-12 col-md-10 offset-md-1'>\n            <img src={image || undefined} className='user-img' />\n            <h4>{username}</h4>\n            <p>{bio}</p>\n\n            {sessionUsername === username ? (\n              <EditProfileButton onClick={onEditSettings} disabled={disabled} />\n            ) : (\n              <ToggleFollowButton\n                following={following}\n                username={username}\n                disabled={disabled}\n                onClick={onFollowToggle}\n              />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction ToggleFollowButton({\n  following,\n  username,\n  disabled,\n  onClick,\n}: {\n  following: boolean;\n  username: string;\n  disabled: boolean;\n  onClick?: () => void;\n}) {\n  return (\n    <button className='btn btn-sm btn-outline-secondary action-btn' onClick={onClick} disabled={disabled}>\n      <i className='ion-plus-round'></i>\n      &nbsp;\n      {following ? ' Unfollow' : ' Follow'} {username}\n    </button>\n  );\n}\n\nfunction EditProfileButton({ disabled, onClick }: { disabled: boolean; onClick?: () => void }) {\n  return (\n    <button className='btn btn-sm btn-outline-secondary action-btn' onClick={onClick} disabled={disabled}>\n      <i className='ion-gear-a'></i>&nbsp; Edit Profile Settings\n    </button>\n  );\n}\n","import { useState } from 'react';\nimport { useLocation, useParams } from 'react-router-dom';\nimport { redirect } from '../../types/location';\nimport { Profile } from '../../types/profile';\nimport { useFollowers, useProfiles, useUser } from '../../services/user';\nimport { ArticlesViewer } from '../ArticlesViewer';\nimport { UserInfo } from '../UserInfo';\n\nexport function ProfilePage() {\n  const user = useUser();\n  const [, emitFollowAction] = useFollowers();\n  const [submittingFollow, setSubmittingFollow] = useState(false);\n\n  const { username } = useParams<{ username: string }>();\n  const favorites = useLocation().pathname.endsWith('favorites');\n\n  const profiles = useProfiles();\n  const profile = profiles && profiles.find((u) => u.username === username);\n\n  async function onFollowToggle(profile: Profile) {\n    if (!user) {\n      redirect('register');\n      return;\n    }\n\n    setSubmittingFollow(true);\n\n    await emitFollowAction({\n      type: profile.following ? 'UnfollowAction' : 'FollowAction',\n      follower: user.uid,\n      leader: profile.uid,\n    });\n\n    setSubmittingFollow(false);\n  }\n\n  return (\n    <div className='profile-page'>\n      {profile ? (\n        <UserInfo\n          user={profile}\n          disabled={submittingFollow}\n          onFollowToggle={() => onFollowToggle(profile)}\n          onEditSettings={() => redirect('settings')}\n        />\n      ) : (\n        <div className='article-preview' key={1}>\n          Loading profile...\n        </div>\n      )}\n      <div className='container'>\n        <div className='row'>\n          <div className='col-xs-12 col-md-10 offset-md-1'>\n            <ArticlesViewer\n              toggleClassName='articles-toggle'\n              tabs={['My Articles', 'Favorited Articles']}\n              selectedTab={favorites ? 'Favorited Articles' : 'My Articles'}\n              onTabChange={onTabChange(username)}\n              uid={profile && profile.uid}\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction onTabChange(username: string): (page: string) => void {\n  return async (page) => {\n    const favorited = page === 'Favorited Articles';\n    redirect(`profile/${username}${!favorited ? '' : 'favorites'}`);\n  };\n}\n","import { format } from 'date-fns';\nimport { Fragment, useState } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { Article } from './../../types/article';\nimport { Comment } from './../../types/comment';\nimport { redirect } from './../../types/location';\nimport { classObjectToClassName } from './../../types/style';\nimport { useFollowers, useUser } from './../../services/user';\nimport { User } from './../../types/user';\nimport { TagList } from './../ArticlePreview';\nimport {\n  useArticleComments,\n  useArticleCommentsDB,\n  useArticleFavorites,\n  useArticles,\n  useArticlesDB,\n} from '../../services/article';\n\nexport function ArticlePage() {\n  const { slug } = useParams<{ slug: string }>();\n\n  const articles = useArticles();\n  const article = articles && articles.find((a) => a.slug === slug);\n\n  if (articles && !article) {\n    redirect('');\n  }\n\n  return article ? (\n    <div className='article-page'>\n      <ArticlePageBanner {...{ article }} />\n\n      <div className='container page'>\n        <div className='row article-content'>\n          <div className='col-md-12'>{article.body}</div>\n          <TagList tagList={article.tagList} />\n        </div>\n\n        <hr />\n\n        <div className='article-actions'>\n          <ArticleMeta {...{ article }} />\n        </div>\n\n        <CommentSection {...{ article }} />\n      </div>\n    </div>\n  ) : (\n    <div>Loading article...</div>\n  );\n}\n\nfunction ArticlePageBanner(props: { article: Article }) {\n  return (\n    <div className='banner'>\n      <div className='container'>\n        <h1>{props.article.title}</h1>\n\n        <ArticleMeta {...props} />\n      </div>\n    </div>\n  );\n}\n\nfunction ArticleMeta({ article }: { article: Article }) {\n  const user = useUser();\n\n  return (\n    <div className='article-meta'>\n      <ArticleAuthorInfo article={article} />\n\n      {user && user.uid === article.author.uid ? (\n        <OwnerArticleMetaActions article={article} />\n      ) : (\n        <NonOwnerArticleMetaActions article={article} />\n      )}\n    </div>\n  );\n}\n\nfunction ArticleAuthorInfo({\n  article: {\n    author: { username, image },\n    createdAt,\n  },\n}: {\n  article: Article;\n}) {\n  return (\n    <Fragment>\n      <Link to={`/profile/${username}`}>\n        <img src={image || undefined} />\n      </Link>\n      <div className='info'>\n        <Link className='author' to={`/profile/${username}`}>\n          {username}\n        </Link>\n        <span className='date'>{format(new Date(createdAt), 'PP')}</span>\n      </div>\n    </Fragment>\n  );\n}\n\nfunction NonOwnerArticleMetaActions({\n  article: {\n    slug,\n    favoritesCount,\n    favorited,\n    author: { username, following, uid },\n  },\n}: {\n  article: Article;\n}) {\n  const [submittingFavorite, setSubmittingFavorite] = useState(false);\n  const [submittingFollow, setSubmittingFollow] = useState(false);\n\n  const user = useUser();\n  const [, emitFavoriteAction] = useArticleFavorites();\n  const [, emitFollowAction] = useFollowers();\n\n  async function onFavorite() {\n    if (!user) {\n      redirect('register');\n      return;\n    }\n\n    setSubmittingFavorite(true);\n\n    await emitFavoriteAction({\n      type: favorited ? 'UnfavoriteAction' : 'FavoriteAction',\n      slug,\n      uid: user.uid,\n    });\n\n    setSubmittingFavorite(false);\n  }\n\n  async function onFollow() {\n    if (!user) {\n      redirect('register');\n      return;\n    }\n\n    setSubmittingFollow(true);\n\n    await emitFollowAction({\n      type: following ? 'UnfollowAction' : 'FollowAction',\n      follower: user.uid,\n      leader: uid,\n    });\n\n    setSubmittingFollow(false);\n  }\n\n  return (\n    <Fragment>\n      <button\n        className={classObjectToClassName({\n          btn: true,\n          'btn-sm': true,\n          'btn-outline-secondary': !following,\n          'btn-secondary': following,\n        })}\n        disabled={submittingFollow}\n        onClick={onFollow}\n      >\n        <i className='ion-plus-round'></i>\n        &nbsp; {(following ? 'Unfollow ' : 'Follow ') + username}\n      </button>\n      &nbsp;\n      <button\n        className={classObjectToClassName({\n          btn: true,\n          'btn-sm': true,\n          'btn-outline-primary': !favorited,\n          'btn-primary': favorited,\n        })}\n        disabled={submittingFavorite}\n        onClick={onFavorite}\n      >\n        <i className='ion-heart'></i>\n        &nbsp; {(favorited ? 'Unfavorite ' : 'Favorite ') + 'Article'}\n        <span className='counter'>({favoritesCount})</span>\n      </button>\n    </Fragment>\n  );\n}\n\nfunction OwnerArticleMetaActions({ article: { slug } }: { article: Article }) {\n  const [deleting, setDeleting] = useState(false);\n\n  const user = useUser();\n  const [, emitArticleAction] = useArticlesDB();\n\n  async function onDeleteArticle() {\n    if (!user) {\n      redirect('');\n      return;\n    }\n\n    setDeleting(true);\n\n    await emitArticleAction({\n      type: 'DeleteArticleAction',\n      slug,\n      uid: user.uid,\n    });\n  }\n\n  return (\n    <Fragment>\n      <button className='btn btn-outline-secondary btn-sm' onClick={() => redirect(`editor/${slug}`)}>\n        &nbsp; Edit Article\n      </button>\n      &nbsp;\n      <button className='btn btn-outline-danger btn-sm' disabled={deleting} onClick={onDeleteArticle}>\n        Delete Article\n      </button>\n    </Fragment>\n  );\n}\n\nfunction CommentSection({ article }: { article: Article }) {\n  const user = useUser();\n  const comments = useArticleComments();\n\n  return (\n    <div className='row'>\n      <div className='col-xs-12 col-md-8 offset-md-2'>\n        {user ? (\n          <CommentForm user={user} slug={article.slug} />\n        ) : (\n          <p style={{ display: 'inherit' }}>\n            <Link to='/login'>Sign in</Link> or <Link to='/register'>sign up</Link> to add comments on this article.\n          </p>\n        )}\n        {comments ? (\n          <Fragment>\n            {(comments[article.slug] || []).map((comment, index) => (\n              <ArticleComment key={comment.id} comment={comment} slug={article.slug} user={user} index={index} />\n            ))}\n          </Fragment>\n        ) : (\n          <div>Loading comments...</div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction CommentForm({ user: { image, uid }, slug }: { user: User; slug: string }) {\n  const [body, setBody] = useState('');\n  const [submittingComment, setSubmitting] = useState(false);\n  const [, emitCommentAction] = useArticleCommentsDB();\n\n  async function onPostComment(ev) {\n    ev.preventDefault();\n\n    setSubmitting(true);\n\n    await emitCommentAction({\n      type: 'CreateComment',\n      uid: uid,\n      body,\n      slug,\n      commentId: Math.random(),\n      createdAt: Date.now(),\n    });\n\n    setBody('');\n    setSubmitting(false);\n  }\n\n  return (\n    <form className='card comment-form' onSubmit={onPostComment}>\n      <div className='card-block'>\n        <textarea\n          className='form-control'\n          placeholder='Write a comment...'\n          rows={3}\n          onChange={(e) => setBody(e.target.value)}\n          value={body}\n        ></textarea>\n      </div>\n      <div className='card-footer'>\n        <img src={image || undefined} className='comment-author-img' />\n        <button className='btn btn-sm btn-primary' disabled={submittingComment}>\n          Post Comment\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction ArticleComment({\n  comment: { commentId, body, createdAt, author },\n  slug,\n  index,\n  user,\n}: {\n  comment: Comment;\n  slug: string;\n  index: number;\n  user: User;\n}) {\n  const { username, image } = author || {};\n\n  const [, emitCommentAction] = useArticleCommentsDB();\n\n  return (\n    <div className='card'>\n      <div className='card-block'>\n        <p className='card-text'>{body}</p>\n      </div>\n      <div className='card-footer'>\n        <Link className='comment-author' to={`/profile/${username}`}>\n          <img src={image || undefined} className='comment-author-img' />\n        </Link>\n        &nbsp;\n        <Link className='comment-author' to={`/profile/${username}`}>\n          {username}\n        </Link>\n        <span className='date-posted'>{format(createdAt, 'PP')}</span>\n        {user && user.username === username && (\n          <span className='mod-options'>\n            <i\n              className='ion-trash-a'\n              aria-label={`Delete comment ${index + 1}`}\n              onClick={() =>\n                emitCommentAction({\n                  slug,\n                  commentId,\n                  uid: user.uid,\n                  type: 'DeleteComment',\n                })\n              }\n            ></i>\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { Fragment } from 'react';\nimport { HashRouter, Redirect, Route, RouteProps, Switch } from 'react-router-dom';\nimport { EditArticle } from './Pages/EditArticle';\nimport { Footer } from './Footer';\nimport { Header } from './Header';\nimport { Home } from './Pages/Home';\nimport { Login } from './Pages/Login';\nimport { NewArticle } from './Pages/NewArticle';\nimport { Register } from './Pages/Register';\nimport { Settings } from './Pages/Settings';\nimport { ProfilePage } from './Pages/ProfilePage';\nimport { ArticlePage } from './Pages/ArticlePage';\nimport { useUser } from '../services/user';\n\nexport function App() {\n  const userIsLogged = !!useUser();\n\n  return (\n    <HashRouter>\n      <Fragment>\n        <Header />\n        <Switch>\n          <GuestOnlyRoute exact path='/login' userIsLogged={userIsLogged}>\n            <Login />\n          </GuestOnlyRoute>\n          <GuestOnlyRoute exact path='/register' userIsLogged={userIsLogged}>\n            <Register />\n          </GuestOnlyRoute>\n          <UserOnlyRoute exact path='/settings' userIsLogged={userIsLogged}>\n            <Settings />\n          </UserOnlyRoute>\n          <UserOnlyRoute exact path='/editor' userIsLogged={userIsLogged}>\n            <NewArticle />\n          </UserOnlyRoute>\n          <UserOnlyRoute exact path='/editor/:slug' userIsLogged={userIsLogged}>\n            <EditArticle />\n          </UserOnlyRoute>\n          <Route path='/profile/:username'>\n            <ProfilePage />\n          </Route>\n          <Route path='/article/:slug'>\n            <ArticlePage />\n          </Route>\n          <Route exact path='/'>\n            <Home />\n          </Route>\n          <Route path='*'>\n            <Redirect to='/' />\n          </Route>\n        </Switch>\n        <Footer />\n      </Fragment>\n    </HashRouter>\n  );\n}\n\n/* istanbul ignore next */\nfunction GuestOnlyRoute({\n  children,\n  userIsLogged,\n  ...rest\n}: { children: JSX.Element | JSX.Element[]; userIsLogged: boolean } & RouteProps) {\n  return (\n    <Route {...rest}>\n      {children}\n      {userIsLogged && <Redirect to='/' />}\n    </Route>\n  );\n}\n\n/* istanbul ignore next */\nfunction UserOnlyRoute({\n  children,\n  userIsLogged,\n  ...rest\n}: { children: JSX.Element | JSX.Element[]; userIsLogged: boolean } & RouteProps) {\n  return (\n    <Route {...rest}>\n      {children}\n      {!userIsLogged && <Redirect to='/' />}\n    </Route>\n  );\n}\n","import ReactDOM from 'react-dom';\nimport './index.css';\nimport { App } from './components/App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}